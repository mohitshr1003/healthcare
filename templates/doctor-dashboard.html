{% extends 'base.html' %}
{% load static %}
{% block css %}
<style>
.divid{
    background-color: white;
    border:1px solid black;
    display: block !important;
    font-size: larger;
    padding: 3px;
    font-weight: bold;
    letter-spacing: 0.1ch;
}
</style>
{% endblock %}
{% block body_content %}
<div class="container mt-3">
    <div class="row">
        <div class="col-6">
            <h1>Welcome Doctor</h1>
        </div>
        <div class="col-6 text-end pt-3">
            <a href="../logout" style="text-decoration: underline !important;">Logout</a>
        </div>
    </div>

    <div class="row">
        <div class="col-8 p-4 ps-3">
            <form method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-6">
                        <input type="text" class="form-control" placeholder='{{ user.username }}' readonly>
                    </div>
                    <div class="col-6">
                        <input type="text"  class="form-control" placeholder="Patient Name" required>
                        <div class="col-3" id="pdata" style="z-index: 999; position:absolute; display: none;"></div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6">
                        <input type="text" name="disease" class="form-control mt-3" placeholder="Disease" required>
                    </div>
                    <div class="col-6">
                        <input type="text" name="symptoms" class="form-control mt-3" placeholder="Symptoms" required>
                    </div>
                </div>
                <div class="row pt-5">
                    <div class="col-7">
                        <h5><strong>MEDICINE NAME</strong></h5>
                    </div>
                    <div class="col-3">
                        <h5><strong>TIME</strong></h5>
                    </div>
                </div>
                <div id="itemsdiv">
                    <div class="row">
                        <div class="col-7">
                            <input type="text" name="med4" class="form-control mt-3" placeholder="Rx" required>
                        </div>
                        <div class="col-3" class="medicinetime">
                            <select class="form-control mt-3" name="time4">
                                <option value="OD">OD</option>
                                <option value="BD">BD</option>
                                <option value="TDS">TDS</option>
                                <option value="HS">HS</option>
                                <option value="SOS">SOS</option>
                            </select>
                        </div>
                        <div class="col-2 mt-3">
                            <button class="btn p-2 px-4" style="background-color:#1aa7ec; color: #fff;" onclick="delitem(this)">delete</button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-7">
                            <input type="text" name="med2" class="form-control mt-3" placeholder="Rx" required>
                        </div>
                        <div class="col-3" class="medicinetime">
                            <select class="form-control mt-3" name="time2">
                                <option value="OD">OD</option>
                                <option value="BD">BD</option>
                                <option value="TDS">TDS</option>
                                <option value="HS">HS</option>
                                <option value="SOS">SOS</option>
                            </select>
                        </div>
                        <div class="col-2 mt-3">
                            <button class="btn p-2 px-4" style="background-color:#1aa7ec; color: #fff;" onclick="delitem(this)">delete</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-7">
                            <input type="text" name="med3" class="form-control mt-3" placeholder="Rx" required>
                        </div>
                        <div class="col-3" class="medicinetime">
                            <select class="form-control mt-3" name="time3">
                                <option value="OD">OD</option>
                                <option value="BD">BD</option>
                                <option value="TDS">TDS</option>
                                <option value="HS">HS</option>
                                <option value="SOS">SOS</option>
                            </select>
                        </div>
                        <div class="col-2 mt-3">
                            <button class="btn p-2 px-4" style="background-color:#1aa7ec; color: #fff;" onclick="delitem(this)">delete</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-7">
                            <input type="text" name="med1" class="form-control mt-3" placeholder="Rx" required>
                        </div>
                        <div class="col-3" class="medicinetime">
                            <select class="form-control mt-3" name="time1">
                                <option value="OD">OD</option>
                                <option value="BD">BD</option>
                                <option value="TDS">TDS</option>
                                <option value="HS">HS</option>
                                <option value="SOS">SOS</option>
                            </select>
                        </div>
                        <div class="col-2 mt-3">
                            <button type="button" onclick="additem()" class="btn p-2 px-4" style="background-color:#1aa7ec; color: #fff;">New</button>
                        </div>
                    </div>
                </div>
                <div class="row" style="display: none;">
                        <div class="col-7">
                            <input type="text" id="medicinecol" class="form-control mt-3" placeholder="Rx" required>
                        </div>
                        <div class="col-3" class="medicinetime">
                            <select class="form-control mt-3" id="timecol">
                                <option value="OD">OD</option>
                                <option value="BD">BD</option>
                                <option value="TDS">TDS</option>
                                <option value="HS">HS</option>
                                <option value="SOS">SOS</option>
                            </select>
                        </div>
                        <div class="col-2 mt-3">
                            <button type="button" onclick="additem()" class="btn p-2 px-4" style="background-color:#1aa7ec; color: #fff;">New</button>
                        </div>
                </div>
                <div class="col-12 pt-3 mt-3 text-end">
                    <button type="submit" onclick="sendinfo()" class="btn p-2 px-4" style="background-color:#1aa7ec; color: #fff;">SEND</button>       
                </div>
                <input type="hidden" id="hiddenelement">
            </form>
        </div>
        <div class="col-4 text-end pt-3">
            <div class="col-12">
                <a href="#">Patient History</a>
            </div>
            <div class="col-12">
                <a href="#">Patient Reports</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
{% block extra_js %}
<script type="text/javascript">
    $(document).ready(
        function(){
        $('#p_name').bind({
        keyup:function(){
            var p_name = $(this).val();
            $.ajax({
                url: "http://127.0.0.1:8000/reception/patient-list?p_name="+p_name,
                success: function(result){
                    var arr_len = result.length;
                    var table = $('#pdata');
                    var tabdata = "";
                    var optionaldata = "<option>No Match</option>"
                    $.each(result,function(i,data){
                        tabdata = tabdata + "<p class='arrdata'>" + data.name  + "</p>"
                    });
            
            if(arr_len>0){
                    table.html(tabdata).addClass('divid');
            }
            else{
                table.html('').removeClass('divid');
            }
            }
            });
        }
        
    });

    $('p.arrdata').hover(function(){
        alert('this');
    });
});
function additem(){
    var d=document.getElementById('itemsdiv');
    var num = d.children.length+1;
    var h=document.getElementById('inputbox');

    const med=document.getElementById('medicinecol');
    var newmed=med;
    newmed.setAttribute('name','med'+num);

    const time=document.getElementById('timecol');
    var newtime=time;
    newtime.setAttribute('name','time'+num);

    var btn = '<button class="btn p-2 px-4" style="background-color:#1aa7ec; color: #fff;" onclick="delitem(this)">delete</button>';

    d.innerHTML= '<div class="row"><div class="col-7" id></div><div class="col-3" class="medicinetime"></div><div class="col-2 mt-3">'+ btn+ '</div></div>' +d.innerHTML ;
    console.log(newmed,newtime);
}
function delitem(t){
        var item= t.parentNode.parentNode;
        item.remove();
}

</script>
{% endblock %}